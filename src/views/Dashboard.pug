extends templates/header.pug

block content
  include templates/nav.pug
  .dashboard-page 
    h1="Dashboard"
    form(class="add-transaction-form" action="/dashboard/add" method="post")
      input(type="text" name="type" placeholder="income or expense")
      input(type="text" name="category" placeholder="category")
      input(type="amount" name="amount" placeholder="amount")
      input(type="date" name="date" placeholder="yyyy-mm-dd")
      input(type="note" name="note" placeholder="note")
      input(type="submit" value="Add Transaction")

    h3="Your Net Saving is "+net 
    h1=message

    h3="Your monthly gain is "+gain 
    if percent_gain
      h3="You gained "+percent_gain+"%"
    
    h3="Your Transactions this Month"

    table.table
      thead 
        th="Amount"
        th="Date" 
        th="Note"
        th="Category"
      each transaction,idx in transactions 
        tr 
          each field, index in transaction
            if index > 1 && index < 6
              td=field
      else 
        tr No transactions

    .pie-chart
      h3="Income"
      script(type='text/javascript' src='https://www.gstatic.com/charts/loader.js')
      script(type='text/javascript').
        google.charts.load("current", {packages:["corechart"]});
        google.charts.setOnLoadCallback(drawIncomeChart);
        function drawIncomeChart() {
          const incomes = !{JSON.stringify(incomes)}
        var data = google.visualization.arrayToDataTable([["Category", "Amount"],...incomes]);
        var options = {
        pieHole: 0.4,
        backgroundColor: 'transparent',
        };
        var chart = new google.visualization.PieChart(document.getElementById('incomechart'));
        chart.draw(data, options);
        }
      #incomechart(style='width: 900px; height: 500px;')

      h3="Expense"  

      script(type='text/javascript').
        google.charts.load("current", {packages:["corechart"]});
        google.charts.setOnLoadCallback(drawExpenseChart);
        function drawExpenseChart() {
          const expenses = !{JSON.stringify(expenses)}
        var data = google.visualization.arrayToDataTable([["Category", "Amount"],...expenses]);
        var options = {
        pieHole: 0.4,
        backgroundColor: 'transparent',
        };
        var chart = new google.visualization.PieChart(document.getElementById('expensechart'));
        chart.draw(data, options);
        }
      #expensechart(style='width: 900px; height: 500px;')

    .bar-graph
      script(type='text/javascript' src='https://www.gstatic.com/charts/loader.js')
      script(type='text/javascript').
        google.charts.load("current", {packages:["corechart"]});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
          const total = !{JSON.stringify(total)}
        var data = google.visualization.arrayToDataTable(total);
        var view = new google.visualization.DataView(data);
        view.setColumns([0, 1,
        { calc: "stringify",
        sourceColumn: 1,
        type: "string",
        role: "annotation" },
        2]);
        var options = {
        backgroundColor: 'transparent',
        title: "Monthly Totals",
        width: 600,
        height: 400,
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
        };
        var chart = new google.visualization.BarChart(document.getElementById("barchart_values"));
        chart.draw(view, options);
        }
      #barchart_values(style='width: 900px; height: 300px;')
    
        

  